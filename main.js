document.addEventListener('DOMContentLoaded',()=>{const e=document.querySelectorAll('.scroll-target'),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add('visible'),t.unobserve(e.target))})},{threshold:.2});e.forEach(e=>t.observe(e));const a=(e,t)=>{e.addEventListener('submit',async a=>{a.preventDefault();try{const a=await fetch(t,{method:'POST',body:new FormData(e)}),s=await a.json();alert(s.message),'success'===s.status&&e.reset()}catch(e){alert('خطا در ارتباط با سرور')}})};const s=document.querySelector('#contact-form');s&&a(s,'php/contact_handler.php');const o=document.querySelector('#booking-form');o&&a(o,'php/booking_handler.php');const n=document.querySelector('.navbar');window.addEventListener('scroll',()=>{n.classList.toggle('scrolled',window.scrollY>50)});const r=document.querySelector('#track-form');r&&r.addEventListener('submit',e=>{e.preventDefault();const t=document.querySelector('#track-input').value.trim();t&&alert(`وضعیت رهگیری ${t}: در دست بررسی`)}),window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches&&(document.documentElement.dataset.theme='dark')});